<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pomodoro Clock</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script><!-- jQuery 3.1.1  -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"><!-- Latest compiled and minified CSS --><!-- BOOTSTRAP -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><!-- Latest compiled and minified JavaScript -->

  <!--  <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />  -->
  <!--  <link href="css/index.css" rel="stylesheet" type="text/css" />  -->
  <!--  <script type="text/javascript" src="js/jquery-2.2.4.min.js"></script> -->
  <!--  <script type="text/javascript" src="js/bootstrap.min.js"></script>  -->

<style>
body {
  background: #161d33; }

#app {
  min-width: 1000px; }

#break {
  padding: 2%;
  font-size: 180%;
  color: #36786f;
  position: absolute;
  left: 25%; }

#session {
  padding: 2%;
  font-size: 180%;
  color: #36786f;
  position: absolute;
  right: 25%; }

#break-minus {
  padding: 2%;
  font-size: 180%;
  font-size: 250%;
  cursor: pointer;
  color: #156718;
  position: absolute;
  top: 20%;
  left: 21%; }

#break-timer {
  padding: 2%;
  font-size: 180%;
  font-size: 250%;
  cursor: pointer;
  color: #156718;
  position: absolute;
  top: 20%;
  font-size: 300%;
  padding: 1.5%;
  cursor: default;
  color: #f0ad4e;
  left: 30%; }

#break-plus {
  padding: 2%;
  font-size: 180%;
  font-size: 250%;
  cursor: pointer;
  color: #156718;
  position: absolute;
  top: 20%;
  left: 39%; }

#session-minus {
  padding: 2%;
  font-size: 180%;
  font-size: 250%;
  cursor: pointer;
  color: #156718;
  position: absolute;
  top: 20%;
  right: 39%; }

#session-timer {
  padding: 2%;
  font-size: 180%;
  font-size: 250%;
  cursor: pointer;
  color: #156718;
  position: absolute;
  top: 20%;
  font-size: 300%;
  padding: 1.5%;
  cursor: default;
  color: #f0ad4e;
  right: 30%; }

#session-plus {
  padding: 2%;
  font-size: 180%;
  font-size: 250%;
  cursor: pointer;
  color: #156718;
  position: absolute;
  top: 20%;
  right: 21%; }

.top-row {
  position: absolute;
  top: 40%;
  left: 43%; }

.bottom {
  position: relative;
  bottom: 1%; }

/*# sourceMappingURL=index.css.map */

</style>
  <script>
/**
 * æ°´çƒå›¾ wataerbubble
 * @author fiona23 (fiona_fanmy@163.com)
 */

(function($) {
  $.fn.waterbubble = function(options) {
    var config = $.extend({
      radius: 100,
      lineWidth: undefined,
      data: 0.5,
      waterColor: 'rgba(25, 139, 201, 1)',
      textColor: 'rgba(06, 85, 128, 0.8)',
      font: '',
      wave: true,
      txt: undefined,
      animation: true
    }, options);

    var canvas = this[0];
    config.lineWidth = config.lineWidth ? config.lineWidth : config.radius/24;

    var waterbubble = new Waterbubble(canvas, config);

    return this;
  }


  function Waterbubble (canvas, config) {
    this.refresh(canvas, config);
  }

  Waterbubble.prototype = {
    refresh: function (canvas, config) {
      canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height)
      this._init(canvas, config)
    },

    _init: function (canvas, config){
      var radius = config.radius;
      var lineWidth = config.lineWidth;

      canvas.width = radius*2 + lineWidth;
      canvas.height = radius*2 + lineWidth;

      this._buildShape(canvas, config);
    },

    _buildShape: function (canvas, config) {

      var ctx = canvas.getContext('2d');

      var gap = config.lineWidth*2;
      //raidus of water
      var r = config.radius - gap;
      var data = config.data;
      var lineWidth = config.lineWidth

      var waterColor = config.waterColor;
      var textColor = config.textColor;
      var font = config.font;

      var wave = config.wave

      // //the center of circle
      var x = config.radius + lineWidth/2;
      var y = config.radius + lineWidth/2;

      ctx.beginPath();

      ctx.arc(x, y, config.radius, 0, Math.PI*2);
      ctx.lineWidth = lineWidth;
      ctx.strokeStyle = waterColor;
      ctx.stroke();
      //if config animation true
      if (config.animation) {
        this._animate(ctx, r, data, lineWidth, waterColor, x, y, wave)
      } else {
        this._fillWater(ctx, r, data, lineWidth, waterColor, x, y, wave);
      }

      if (typeof config.txt == 'string'){
        this._drawText(ctx, textColor, font, config.radius, data, x, y, config.txt);
      }

      return;
    },

    _fillWater: function (ctx, r, data, lineWidth, waterColor, x, y, wave) {
      ctx.beginPath();

      ctx.globalCompositeOperation = 'destination-over';

      //start co-ordinates
      var sy = r*2*(1 - data) + (y - r);
      var sx = x - Math.sqrt((r)*(r) - (y - sy)*(y - sy));
      //middle co-ordinates
      var mx = x;
      var my = sy;
      //end co-ordinates
      var ex = 2*mx - sx;
      var ey = sy;

      var extent; //extent

      //if (data > 0.9 || data < 0.1 || !wave) {
        extent = sy
      /* } else{
        extent = sy - (mx -sx)/4
      } */

      ctx.beginPath();

      ctx.moveTo(sx, sy)
      ctx.quadraticCurveTo((sx + mx)/2, extent, mx, my);
      ctx.quadraticCurveTo((mx + ex)/2, 2*sy - extent, ex, ey);

      var startAngle = -Math.asin((x - sy)/r)
      var endAngle = Math.PI - startAngle;

      ctx.arc(x, y, r, startAngle, endAngle, false)

      ctx.fillStyle = waterColor;
      ctx.fill()
    },

    _drawText: function (ctx, textColor, font, radius, data, x, y, txt) {
      ctx.globalCompositeOperation = 'source-over';

      var size = font ? font.replace( /\D+/g, '') : 0.4*radius;
      ctx.font = font ? font : 'bold ' + size + 'px Microsoft Yahei';

      txt = txt.length ? txt : data*100 + '%'

      var sy = y + size/2;
      var sx = x - ctx.measureText(txt).width/2

      ctx.fillStyle = textColor;
      ctx.fillText(txt, sx, sy)
    },

    _animate: function (ctx, r, data, lineWidth, waterColor, x, y, wave) {
      var datanow = {
        value: 0
      };
      var requestAnimationFrame = window.requestAnimationFrame || window.msRequestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || function (func) {
            setTimeout(func, 16);
          };
      var self = this;
      var update = function () {
        if (datanow.value < data) {
          datanow.value += (data - datanow.value)/15
          self._runing = true;
        } else {
          self._runing = false;
        }
      }
      var step = function () {
        self._fillWater(ctx, r, datanow.value, lineWidth, waterColor, x, y, wave);
        update();
        if (self._runing) {
          requestAnimationFrame(step);
        }
      }
      step(ctx, r, datanow, lineWidth, waterColor, x, y, wave)
    }
  }
}(jQuery));

  </script>
  <script>
  $(document).ready(function () {
    $breakTimer = $('#break-timer');
    $sessionTimer = $('#session-timer');
    $breakMinus = $('#break-minus');
    $breakPlus = $('#break-plus');
    $sessionMinus = $('#session-minus');
    $sessionPlus = $('#session-plus');
    $status = $('#status');

    function decrement(sel,val){
      sel.html((+val) - 1);
    }

    function increment(sel,val){
      sel.html((+val) + 1);
    }

    $breakMinus.click(function () {
      $status.html('Break!');
      decrement($breakTimer, $breakTimer.html());
    });

    $breakPlus.click(function () {
      $status.html('Break!');
      increment($breakTimer, $breakTimer.html());
    });

    $sessionMinus.click(function () {
      $status.html('Session!');
      decrement($sessionTimer, $sessionTimer.html());
    });

    $sessionPlus.click(function () {
      $status.html('Session!');
      increment($sessionTimer, $sessionTimer.html());
    });

    function pad(val) {
      return ('00' + val).slice(-2);
    }

    var el = document.getElementById('timer');

    function updateDisplay(t) {
      var hours = Math.floor(t / 3600);
      t -= hours * 3600;
      var minutes = Math.floor(t / 60);
      t -= minutes * 60;
      var seconds = Math.floor(t);
      el.innerHTML = pad(hours) + ':' + pad(minutes) + ':' + pad(seconds);
    }

    time = 0;
    updateDisplay(time);
    var running = true;
    var tlast = (new Date()).getTime();

    function update() {
      if (time <= 0.0) { // Already done
        return;
      }
      var tnow = (new Date()).getTime();
      var dt = (tnow - tlast) / 1000.0;
      tlast = tnow;
      time -= dt;
      if ($status.html() === 'Session!') {
        totalTime = ($sessionTimer.html() * 60);
        water = 'rgba(25, 139, 201, 1)';
      }

      if ($status.html() === 'Break!') {
        totalTime = ($breakTimer.html() * 60);
        water = 'rgba(255, 0, 0, 1)';
      }

      fraction = 1 - (time / totalTime);

      $('#progress').waterbubble({
        data: fraction,
        animation: false,
        waterColor: water
      });

      if (time <= 0.0) {
        //el.innerHTML = 'Finished';
        if ($status.html() === 'Session!') {
          $status.html('Break!');
          time = $breakTimer.html() * 60;

        } else {
          $status.html('Session!');
          time = $sessionTimer.html() * 60;

        }
      }
      updateDisplay(time);
      if (running) {
        requestAnimationFrame(update);
      }

    }

    function run() {
      $status.html('Session!');
      if (time <= 0.0) {
        time = $sessionTimer.html() * 60;
      }
      tlast = (new Date()).getTime();
      running = true;
      requestAnimationFrame(update);
    }

    function pause() {
      running = false;
    }

    function stop() {
      running = false;
      time = 0;
      el.innerHTML = '00:00:00';
      $status.html('Session!');
      $sessionTimer.html(25);
      $breakTimer.html(5);
      $('#progress').waterbubble({
        data: 0.0,
        animation: false,
        waterColor: 'rgba(25, 139, 201, 1)'
      });
    }

    var bStart = document.getElementById('start');
    var bPause = document.getElementById('pause');
    var bReset = document.getElementById('reset');

    bStart.onclick = run;
    bPause.onclick = pause;
    bReset.onclick = stop;

    $('#progress').waterbubble(

        {

          // bubble size
          radius: 100,

          // border width
          lineWidth: undefined,

          // data to present
          data: 0.0,

          // color of the water bubble
          waterColor: 'rgba(25, 139, 201, 1)',

          // text color
          textColor: 'rgba(06, 85, 128, 0.8)',

          // custom font family
          font: '',

          // show wave
          wave: true,

          // custom text displayed inside the water bubble
          txt: undefined,

          // enable water fill animation
          animation: false

        });
  });
  </script>
</head>
<body>
  <div id="app">
    <h1 class="text-center text-success"><b>POMODORO CLOCK</b></h1>
    <div class="container1">
      <span id="break">Break</span>
      <span id="session">Session</span>
      <div id="break-item">
        <span id="break-minus"><button>-</button></span>
        <span id="break-timer">1</span>
        <span id="break-plus"><button>+</button></span>
      </div>
      <div id="session-item">
        <span id="session-minus"><button>-</button></span>
        <span id="session-timer">1</span>
        <span id="session-plus"><button>+</button></span>
      </div>
    </div>
    <div class="top-row text-primary">
      <h2 id="status" class="text-info text-center">Session!</h2>
      <canvas id="progress"></canvas>
      <h1 id="timer" class="text-center"></h1>
      <div class="text-primary bottom">
        <button type="button" id="start" class="btn btn-success"> Start </button>
        <button type="button" id="pause" class="btn btn-warning"> Pause </button>
        <button type="button" id="reset" class="btn btn-danger"> Reset </button>
      </div>
    </div>
  </div>
</body>
</html>
